---
import MainLayout from "@layouts/MainLayout.astro";
import {TodayIsHoliday} from "@components/TodayIsHoliday";
import LongDate from "@components/LongDate.astro";
import {HolidayCard} from "@components/cards/HolidayCard";
import {Timer} from "@components/Timer";
import type {Holiday} from "@data/2024/holidays";
import {format, isAfter, isBefore} from "@formkit/tempo"

import {actions} from "astro:actions";
import Header from "@components/shared/Header.astro";

const currentYear = Number(format({
    date: new Date(),
    format: "YYYY",
    tz: "America/Santiago"
}));

const {data} = await actions.GetAllHolidays({}) as { data: Holiday[] };

// Get next holidays from today
const nextHolidays = data.filter((item: Holiday) => {
    return item.date !== undefined && isAfter(item.date, new Date());
});

// Get last holidays from today
const lastHolidays = data.filter((item: Holiday) => {
    return item.date !== undefined && isBefore(item.date, new Date());
});
---

<MainLayout>
    <Header
            title="Feriados Chile"
            currentYear={currentYear}
            href="/"
    />
    <div class="container mx-auto p-4">

        <div class="flex justify-center">
            <LongDate/>
            <span class="ml-2">-</span>
            <div class="w-20 text-center inline-block">
                <Timer client:only="react"/>
            </div>
        </div>

        <!-- hoy es feriado? -->
        <div class="min-h-[190px]">
            <TodayIsHoliday client:load/>
        </div>

        <!-- Feriados Generales -->
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">
                ℹ️ ¿Qué feriados {currentYear} van quedando?
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {
                    nextHolidays.map((item: Holiday) => (
                            <HolidayCard holiday={item}/>
                    ))
                }
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">
                🔙 Feriados que ya pasaron
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {
                    lastHolidays.map((item: Holiday) => (
                            <HolidayCard holiday={item}/>
                    ))
                }
            </div>
        </section>

        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">
                🗓️ Feriados por año
            </h2>
            <div class="flex flex-wrap">
                <a href="/2024">
                    <div class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-200 hover:text-gray-500 hover:font-bold overflow-hidden">
                        Feriados 2024
                    </div>
                </a>
            </div>
        </section>
    </div>
</MainLayout>